{"version":3,"file":"static/js/415.4666dfa7.chunk.js","mappings":"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","sources":["pages/ServerLogs/ServerLogs.js"],"sourcesContent":["import React, { useState, useEffect, Fragment, useRef } from 'react'\r\nimport { useSelector } from 'react-redux';\r\nimport { Button, Fab, Paper, Box } from '@mui/material';\r\nimport { KeyboardArrowDown, KeyboardDoubleArrowLeft, KeyboardDoubleArrowRight, Visibility } from '@mui/icons-material';\r\nimport { v4 } from 'uuid';\r\nimport io from 'socket.io-client';\r\nimport { SERVER_LINK } from '../../dev-server-link';\r\nimport './ServerLogs.css';\r\nimport LoadingSpinner from './../../compenents/LoadingSpinner/LoadingSpinner';\r\n\r\nconst ServerLogs = () => {\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(undefined);\r\n    const [stdout, setStdout] = useState({});\r\n    const [stderr, setStderr] = useState({});\r\n    const [isOut, setIsOut] = useState(true);\r\n    const endRef = useRef(null);\r\n    const [pageNo, setPageNo] = useState(1);\r\n\r\n    useFetchServerLogs(setLoading, setError, setStderr, setStdout, pageNo);\r\n    useServerLogsSocket(setStdout, setStderr);\r\n    useColorTokens([isOut, stderr, stdout]);\r\n\r\n    return (\r\n        <Fragment>\r\n            <Tools\r\n                endRef={endRef} isOut={isOut} pageNo={pageNo}\r\n                setIsOut={setIsOut} setPageNo={setPageNo}\r\n            />\r\n            {loading && <LoadingSpinner />}\r\n            {!loading && error && <div className='errorTemplate' style={{ width: '70vw' }}>\r\n                <div><span>Msg : </span>{error.msg}</div>\r\n                {error && <div><span>Error : </span>{JSON.stringify(error.error)}</div>}\r\n            </div>}\r\n            {!loading && !error && (\r\n                <Fragment>\r\n                    <pre id='out-pre' style={{\r\n                        display: 'flex',\r\n                        flexDirection: 'column',\r\n                        alignItems: 'flex-start',\r\n                        margin: '6rem 1rem',\r\n                        fontSize: '0.6rem'\r\n                    }}>\r\n                        {isOut ?\r\n                            [...stdout].reverse().map(txt => (\r\n                                <div key={txt.id}>{txt.msg}</div>\r\n                            )) :\r\n                            stderr.map(txt => (\r\n                                <div key={txt.id}>{txt.msg}</div>\r\n                            ))\r\n                        }\r\n                    </pre>\r\n                    <div ref={endRef} aria-hidden />\r\n                </Fragment>\r\n            )}\r\n        </Fragment>\r\n    );\r\n}\r\n\r\n\r\nconst useServerLogsSocket = (setStdout, setStderr) => {\r\n    const loginState = useSelector(state => state.auth);\r\n    useEffect(() => {\r\n        if (!loginState.isAdmin) return;\r\n        const newSocket = io(SERVER_LINK, { query: { id: v4() } });\r\n        newSocket.on('logger-new-log', msg => {\r\n            setStdout(prev => [...prev, { msg, id: v4() }])\r\n        });\r\n        newSocket.on('logger-new-error', msg => {\r\n            setStderr(prev => [...prev, { msg, id: v4() }])\r\n        });\r\n        return () => newSocket.close();\r\n    }, [loginState.username, loginState.isAdmin, setStdout, setStderr]);\r\n}\r\n\r\nconst useFetchServerLogs = (setLoading, setError, setStderr, setStdout, pageNo) => {\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        setError(undefined);\r\n        fetch(\r\n            `${SERVER_LINK}/api/experimental/logs?pageNo=${pageNo}`,\r\n            {\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                method: 'GET',\r\n                credentials: 'include'\r\n            }\r\n        )\r\n            .then(async response => {\r\n                if (response.ok) return response.json();\r\n                const json = await response.json();\r\n                return await Promise.reject(json);\r\n            })\r\n            .then(res => {\r\n                setStdout(res.stdoutTxt.trim().split('\\n').map(txt => ({ msg: txt, id: v4() })));\r\n                setStderr(res.stderrTxt.trim().split('\\n').map(txt => ({ msg: txt, id: v4() })));\r\n            })\r\n            .catch(setError)\r\n            .finally(() => setLoading(false))\r\n    }, [setLoading, setError, setStderr, setStdout, pageNo]);\r\n}\r\n\r\nconst useColorTokens = dependency => {\r\n    useEffect(() => {\r\n        // setting timeout so that this process don't block rendering\r\n        const timeoutId = setTimeout(() => {\r\n            const outPre = document.getElementById('out-pre');\r\n            if (!outPre) return;\r\n            // tokens: [searchKey, className, regexFlags]\r\n            [...outPre.childNodes].every(child => {\r\n                if (child.getAttribute(\"tokenized\") === \"ok\") return false;\r\n                child.innerHTML = tokenize(child.innerHTML);\r\n                child.setAttribute(\"tokenized\", \"ok\");\r\n                return true;\r\n            });\r\n        }, 10);\r\n        return () => clearTimeout(timeoutId);\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, dependency);\r\n}\r\n\r\n// searchKey, className, regexFlags\r\nconst tokens = [\r\n    ['GET', 'get', 'g'],\r\n    ['POST', 'post', 'g'],\r\n    ['PUT', 'put', 'g'],\r\n    ['DELETE', 'delete', 'g'],\r\n    ['Unlinked', 'unlinked', 'g'],\r\n    ['PORT', 'port', 'g'],\r\n    ['Database', 'database', 'g'],\r\n    ['Production', 'production', 'g'],\r\n    ['Note:', 'note', 'g'],\r\n    ['Add Note', 'addnote', 'g'],\r\n    ['Edit Note', 'editnote', 'g'],\r\n    ['Delete Note', 'deletenote', 'g'],\r\n    ['Containers', 'containers', 'g'],\r\n    ['Deleted', 'deleted', 'g'],\r\n    ['Error', 'error', 'g'],\r\n    ['failed', 'failed', 'g'],\r\n    ['LOG', 'log', 'g'],\r\n];\r\n\r\nconst tokenize = text => {\r\n    tokens.forEach(tokenDetail => (\r\n        text = text.replace(new RegExp(tokenDetail[0], tokenDetail[2]), `<span class='token token-${tokenDetail[1]}'>${tokenDetail[0]}</span>`)\r\n    ));\r\n    const timeVar = text.match('[0-9]+/[0-9]+/[0-9]+, [0-9]+:[0-9]+:[0-9]+ [a-zA-Z][a-zA-Z]');\r\n    timeVar && (text = text.replace(timeVar[0], `<span class='token-time'>${timeVar[0]}</span>`));\r\n    return text;\r\n}\r\n\r\nconst Tools = ({ setIsOut, isOut, endRef, setPageNo, pageNo }) => {\r\n    return (\r\n        <Fragment>\r\n            <Button\r\n                variant='contained'\r\n                color='success'\r\n                onClick={() => setIsOut(prev => !prev)}\r\n                sx={{ position: 'fixed', top: '5em', right: '1em', textTransform: 'capitalize', opacity: '0.9' }}\r\n                startIcon={<Visibility />}\r\n            >\r\n                {isOut ? 'show stderr' : 'show stdout'}\r\n            </Button>\r\n            <Box sx={{ position: 'fixed', display: 'flex', top: '8em', right: '1em', opacity: '0.9' }} >\r\n                <Fab onClick={() => setPageNo(prev => (prev === 1 ? 1 : prev - 1))} size=\"small\" color=\"primary\" aria-label=\"add\">\r\n                    <KeyboardDoubleArrowLeft />\r\n                </Fab>\r\n                <Paper elevation={3} sx={{ width: '35px', height: '35px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '1.2em', margin: '0 0.2em' }} >{pageNo}</Paper>\r\n                <Fab onClick={() => setPageNo(prev => prev + 1)} size=\"small\" color=\"primary\" aria-label=\"add\">\r\n                    <KeyboardDoubleArrowRight />\r\n                </Fab>\r\n            </Box>\r\n            <Fab onClick={() => {\r\n                endRef.current && endRef.current.scrollIntoView();\r\n            }} style={{\r\n                position: 'fixed', bottom: '4.5em', right: '1em', opacity: '0.9'\r\n            }} size=\"small\" color=\"primary\" aria-label=\"add\">\r\n                <KeyboardArrowDown />\r\n            </Fab>\r\n        </Fragment>\r\n    );\r\n}\r\n\r\nexport default ServerLogs;\r\n"],"names":["useServerLogsSocket","setStdout","setStderr","loginState","useSelector","state","auth","useEffect","isAdmin","newSocket","io","SERVER_LINK","query","id","v4","on","msg","prev","concat","_toConsumableArray","close","username","useFetchServerLogs","setLoading","setError","pageNo","undefined","fetch","headers","method","credentials","then","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","json","wrap","_context","next","ok","abrupt","sent","Promise","reject","stop","_x","apply","arguments","res","stdoutTxt","trim","split","map","txt","stderrTxt","catch","finally","useColorTokens","dependency","timeoutId","setTimeout","outPre","document","getElementById","childNodes","every","child","getAttribute","innerHTML","tokenize","setAttribute","clearTimeout","tokens","text","forEach","tokenDetail","replace","RegExp","timeVar","match","Tools","_ref2","setIsOut","isOut","endRef","setPageNo","_jsxs","Fragment","children","_jsx","Button","variant","color","onClick","sx","position","top","right","textTransform","opacity","startIcon","Visibility","Box","display","Fab","size","KeyboardDoubleArrowLeft","Paper","elevation","width","height","alignItems","justifyContent","fontSize","margin","KeyboardDoubleArrowRight","current","scrollIntoView","style","bottom","KeyboardArrowDown","_useState","useState","_useState2","_slicedToArray","loading","_useState3","_useState4","error","_useState5","_useState6","stdout","_useState7","_useState8","stderr","_useState9","_useState10","useRef","_useState11","_useState12","LoadingSpinner","className","JSON","stringify","flexDirection","reverse","ref"],"sourceRoot":""}